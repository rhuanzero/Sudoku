package Game.model;
import java.util.Collection;
import java.util.List;
import java.util.Objects;

import static java.util.Objects.isNull;
import static java.util.Objects.nonNull;
import static Game.model.GameStatus.*;

public class Board {
    private final List<List<Space>> spaces;




    public Board(List<List<Space>> spaces) {
        this.spaces = spaces;
    }

    public List<List<Space>> getSpaces() {
        return spaces;
    }

    public GameStatus gameStatus(){
        if (spaces.stream().flatMap(Collection::stream).noneMatch(s -> !s.isFixed() && nonNull(s.getActual()))){
            return NON_STARTED;
        }
        return spaces.stream()
                .flatMap(Collection::stream)
                .anyMatch(s -> isNull(s.getActual())) ? INCOMPLETE : COMPLETE;
    }

    public boolean hasErrors(){
        if (gameStatus() == NON_STARTED)
            return false;

        return spaces.stream().flatMap(Collection::stream)
                .anyMatch(s-> nonNull(s.getActual()) && !s.getActual().equals(s.getExpected()));

    }

    public boolean changeValue(int col, int row, int value){
        var space = spaces.get(col).get(row);

        if(space.isFixed()){
            return false;
        }

        space.setActual(value);
        return true;
    }

    public boolean clearValue(int col, int row){
        var space = spaces.get(col).get(row);

        if(space.isFixed()){
            return false;
        }

        space.clearSpace();
        return true;
    }

    public void reset(){
        spaces.forEach(c -> c.forEach(Space::clearSpace));
    }

    public boolean gameIsFinished(){
        return !hasErrors() && gameStatus() == COMPLETE;
    }



    public final static String BOARD_TEMPLATE =
        """
        *************************************************************************************
        *|---0---||---1---||---2---|*|---3---||---4---||---5---|*|---6---||---7---||---8---|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        0|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |0
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        1|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |1
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        2|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |2
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *************************************************************************************
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        3|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |3
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        4|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |4
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        5|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |5
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *************************************************************************************
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        6|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |6
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        7|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |7
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|-------||-------||-------|*|-------||-------||-------|*|-------||-------||-------|*
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        8|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |*|  %s   ||  %s   ||  %s   |8
        *|       ||       ||       |*|       ||       ||       |*|       ||       ||       |*
        *|---0---||---1---||---2---|*|---3---||---4---||---5---|*|---6---||---7---||---8---|*
        *************************************************************************************
        """;


}
